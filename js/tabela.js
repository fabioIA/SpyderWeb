// Criando lista de filmes, e exportando ela
export let video = [

    {
        midia: "Capitão América: O Primeiro Vingador (2011)",
        tipo: "Filme",
        fase: "1",
        class: "12",
        g1: "Ação",
        g2: "Aventura",
        g3: "Ficção Científica",
    },
    {
        midia: "Capitã Marvel (2019)",
        tipo: "Filme",
        fase: "3",
        class: "12",
        g1: "Ação",
        g2: "Ficção Científica",
        g3: "Aventura",			
    },
    {
        midia: "Homem de Ferro (2008)",
        tipo: "Filme",
        fase: "1",
        class: "12",
        g1: "Ação",
        g2: "Ficção Científica",
        g3: "Aventura",	
    },
    {
        midia: "O Incrível Hulk (2008)",
        tipo: "Filme",
        fase: "1",
        class: "10",
        g1: "Ação",
        g2: "Ficção Científica",
        g3: "Suspense",	
    },
    {
        midia: "Homem de Ferro 2 (2010)",
        tipo: "Filme",
        fase: "1",
        class: "12",
        g1: "Ação",
        g2: "Ficção Científica",
        g3: "Aventura",		
    },
    {
        midia: "Thor (2011)",
        tipo: "Filme",
        fase: "1",
        class: "10",
        g1: "Ação",
        g2: "Fantasia",
        g3: "Aventura",	
    },
    {
        midia: "Os Vingadores (2012)",
        tipo: "Filme",
        fase: "1",
        class: "12",
        g1: "Ação",
        g2: "Aventura",
        g3: "Ficção Científica",	
    },
    {
        midia: "Homem de Ferro 3 (2013)",
        tipo: "Filme",
        fase: "2",
        class: "12",
        g1: "Ação",
        g2: "Ficção Científica",
        g3: "Comédia",		
    },
    {
        midia: "Thor: O Mundo Sombrio (2013)",
        tipo: "Filme",
        fase: "2",
        class: "10",
        g1: "Ação",
        g2: "Aventura",
        g3: "Fantasia",	
    },
    {
        midia: "Capitão América 2 – O Soldado Invernal (2014)",
        tipo: "Filme",
        fase: "2",
        class: "12",
        g1: "Ação",
        g2: "Aventura",
        g3: "Suspense",	
    },
    {
        midia: "Guardiões da Galáxia (2014)",
        tipo: "Filme",
        fase: "2",
        class: "12",
        g1: "Ação",
        g2: "Ficção Científica",
        g3: "Comédia",	
    },
    {
        midia: "Guardiões da Galáxia Vol. 2 (2017)",
        tipo: "Filme",
        fase: "3",
        class: "12",
        g1: "Ação",
        g2: "Ficção Científica",
        g3: "Comédia",	
    },
    {
        midia: "Vingadores: Era de Ultron (2015)",
        tipo: "Filme",
        fase: "2",
        class: "12",
        g1: "Ação",
        g2: "Ficção Científica",
        g3: "Aventura",
    },
    {
        midia: "Homem-Formiga (2015)",
        tipo: "Filme",
        fase: "2",
        class: "12",
        g1: "Ação",
        g2: "Aventura",
        g3: "Comédia",
    },
    {
        midia: "Capitão América: Guerra Civil (2016)",
        tipo: "Filme",
        fase: "3",
        class: "12",
        g1: "Ação",
        g2: "Aventura",
        g3: "suspense",
    },
    {
        midia: "Pantera Negra (2018)",
        tipo: "Filme",
        fase: "2",
        class: "14",
        g1: "Ação",
        g2: "Aventura",
        g3: "Ficção Científica",
    },
    {
        midia: "Homem-Aranha: De Volta ao Lar (2017)",
        tipo: "Filme",
        fase: "3",
        class: "12",
        g1: "Ação",
        g2: "Aventura",
        g3: "Comédia",
    },
    {
        midia: "Viúva Negra (2021)",
        tipo: "Filme",
        fase: "4",
        class: "12",
        g1: "Ação",
        g2: "Ficção Científica",
        g3: "suspense",
    },
    {
        midia: "Doutor Estranho (2016)",
        tipo: "Filme",
        fase: "3",
        class: "12",
        g1: "Ação",
        g2: "Aventura",
        g3: "Fantasia",	
    },
    {
        midia: "Thor: Ragnarok (2017)",
        tipo: "Filme",
        fase: "3",
        class: "12",
        g1: "Ação",
        g2: "Ficção Científica",
        g3: "Comédia",
    },
    {
        midia: "Homem-Formiga e a Vespa (2018)",
        tipo: "Filme",
        fase: "3",
        class: "12",
        g1: "Ação",
        g2: "Aventura",
        g3: "Comédia",
    },
    {
        midia: "Vingadores: Guerra Infinita (2018)",
        tipo: "Filme",
        fase: "3",
        class: "12",
        g1: "Ação",
        g2: "Ficção Científica",
        g3: "Aventura",
    },
    {
        midia: "Vingadores: Ultimato (2019)",
        tipo: "Filme",
        fase: "3",
        class: "12",
        g1: "Ação",
        g2: "Ficção Científica",
        g3: "Aventura",
    },
    {
        midia: "Loki (2021)",
        tipo: "Série",
        fase: "4",
        class: "14",
        g1: "Ficção Científica",
        g2: "Fantasia",
        g3: "Ação",	
    },
    {
        midia: "What if…? (2021)",
        tipo: "Série",
        fase: "4",
        class: "14",
        g1: "Ação",
        g2: "Ficção Científica",
        g3: "Aventura",
    },
    {
        midia: "WandaVision (2021)",
        tipo: "Série",
        fase: "4",
        class: "14",
        g1: "Ficção Científica",
        g2: "Fantasia",
        g3: "suspense",
    },
    {
        midia: "Falcão e o Soldado Invernal (2021)",
        tipo: "Série",
        fase: "4",
        class: "14",
        g1: "Ação",
        g2: "Ficção Científica",
        g3: "Amizade",
    },
    {
        midia: "Eternos (2021)",
        tipo: "Filme",
        fase: "4",
        class: "12",
        g1: "Ação",
        g2: "Fantasia",
        g3: "Ficção Científica",	
    },
    {
        midia: "Shang-Chi e a Lenda dos Dez Anéis (2021)",
        tipo: "Filme",
        fase: "4",
        class: "12",
        g1: "Ação",
        g2: "Fantasia",
        g3: "Ficção Científica",	
    },
    {
        midia: "Homem-Aranha: Longe de Casa (2019)",
        tipo: "Filme",
        fase: "3",
        class: "10",
        g1: "Ação",
        g2: "Ficção Científica",
        g3: "Comédia",
    },
    {
        midia: "Homem-Aranha: Sem Volta Para Casa (2021)",
        tipo: "Filme",
        fase: "4",
        class: "12",
        g1: "Ação",
        g2: "Ficção Científica",
        g3: "Comédia",	
    },
    {
        midia: "Doutor Estranho no Multiverso da Loucura (2022)",
        tipo: "Filme",
        fase: "4",
        class: "14",
        g1: "Ação",
        g2: "Aventura",
        g3: "Ficção Científica",	
    },
    {
        midia: "Gavião Arqueiro (2021)",
        tipo: "Série",
        fase: "4",
        class: "14",
        g1: "Ação",
        g2: "Aventura",
        g3: "Amizade",	
    },
    {
        midia: "Thor: Amor e Trovão (2022)",
        tipo: "Filme",
        fase: "4",
        class: "14",
        g1: "Ação",
        g2: "Aventura",
        g3: "Comédia",	
    },
    {
        midia: "Cavaleiro da Lua (2022)",
        tipo: "Série",
        fase: "4",
        class: "14",
        g1: "Ação",
        g2: "Fantasia",
        g3: "Suspense",
    },
    {
        midia: "Ms. Marvel (2022)",
        tipo: "Série",
        fase: "4",
        class: "14",
        g1: "Ação",
        g2: "Aventura",
        g3: "Comédia",	
    },
    {
        midia: "She-Hulk (2022)",
        tipo: "Série",
        fase: "4",
        class: "14",
        g1: "Ação",
        g2: "Ficção Científica",
        g3: "Comédia",		
    },
    {
        midia: "Pantera Negra - Wakanda Forever (2022)",
        tipo: "Filme",
        fase: "4",
        class: "10",
        g1: "Ação",
        g2: "Aventura",
        g3: "Ficção Científica",	
    },

];

// Adiciona novas entradas de genêro
document.getElementById('add').addEventListener('click', function() {

    // Vai tentar adicionar o genero 3 se não conseguir adiciona o 2
    try {
        document.getElementById('genero3').innerHTML = '<span>Genêro:</span><select name="g3" id="g3"><option value=""></option><option value="Fantasia">Fantasia</option><option value="Ação">Ação</option><option value="Aventura">Aventura</option><option value="Ficção Científica">Ficção Científica</option><option value="Comédia">Comédia</option><option value="Amizade">Amizade</option><option value="Suspense">Suspense</option></select>';
        document.getElementById('add').parentNode.removeChild(document.getElementById('add'));
        // document.getElementById('generos').innerHTML += '<input id="sub" type="button" value="-"/>';
        
    } catch (error) {
        document.getElementById('generos').innerHTML += '<span>Genêro:</span><select name="g2" id="g2"><option value=""></option><option value="Fantasia">Fantasia</option><option value="Ação">Ação</option><option value="Aventura">Aventura</option><option value="Ficção Científica">Ficção Científica</option><option value="Comédia">Comédia</option><option value="Amizade">Amizade</option><option value="Suspense">Suspense</option></select><div id="genero3"></div>';
    }

})

// Chama essa função toda vez que clicar no botão de busca
document.getElementById('buscar').onclick = () => {
    console.log('btn')

    // Verifica se uns dos selects foi preenchido
    if(document.getElementById('tipo').value !== "" | document.getElementById('fases').value !== "" | document.getElementById('classificacao').value !== "" | document.getElementById('g1').value !== "") {

        // Cria uma tabela
        document.getElementById('tabela').innerHTML = '<table id="mesa" border="2"><thead><tr><th>N°</th><th>Nome</th><th>Tipo</th><th>Fase</th><th>Classificação</th><th colspan="3">Genêros</th></tr></thead></table>';
        Main();
        return;

    }else {
        console.log('senão')

        // Tenta adicionar a tabela caso o g2 ou g3 estajam preenchidos
        try {
            if(document.getElementById('g3').value !== '') {
                document.getElementById('tabela').innerHTML = '<table id="mesa" border="2"><thead><tr><th>N°</th><th>Nome</th><th>Tipo</th><th>Fase</th><th>Classificação</th><th colspan="3">Genêros</th></tr></thead></table>';
                Main();

                console.log('G3');

                return;

            }else if(document.getElementById('g2').value !== '') {
                document.getElementById('tabela').innerHTML = '<table id="mesa" border="2"><thead><tr><th>N°</th><th>Nome</th><th>Tipo</th><th>Fase</th><th>Classificação</th><th colspan="3">Genêros</th></tr></thead></table>';
                Main();
                
                console.log('G2');

                return;

            }
        } catch (error) {

            try {
                if(document.getElementById('g2').value !== '') {
                    document.getElementById('tabela').innerHTML = '<table id="mesa" border="2"><thead><tr><th>N°</th><th>Nome</th><th>Tipo</th><th>Fase</th><th>Classificação</th><th colspan="3">Genêros</th></tr></thead></table>';
                    Main();
                    
                    console.log('G2');

                    return;

                }

            } catch (error) {
                // Mensagem caso usuário não tenha filtrado
                alert("Filtre antes de buscar");

                return;

            }
            
        }
    }
}

function Main() {
    // Definindo variável e constânte
    let t = 0;
    const array = [];

    // Verifica qual dos selects foi preenchido, e chama a função para juntar os arrays
    if(document.getElementById('tipo').value !== ""){
        t++;
        Junta(Tipo(), array);
        
    }
    if(document.getElementById('fases').value !== "") {
        t++;
        Junta(Fases(), array);

    }
    if(document.getElementById('classificacao').value !== "") {
        t++;
        Junta(Class(), array);
    
    }
    if(document.getElementById('g1').value !== "") {
        t++;
        Junta(Gen(document.getElementById('g1').value), array);

    }

    try {

        if(document.getElementById('g2').value !== "") {
            Junta(Gen(document.getElementById('g2').value), array);
            t++;

        } 
    } catch (error) {
        null;
    }
    
    try {

        if(document.getElementById('g3').value !== "") {
            t++;
            Junta(Gen(document.getElementById('g3').value), array);

        }
    } catch (error) {
        null;
        
    }
    
    // Chama a função que organiza a array
    Organiza(array, t);
}
        

// Junta todas as arrays em só uma
function Junta(valor, array) {
    
    for(let i = 0; i < valor.length; i++) {
        array[array.length] = valor[i];

    }

}

// Organiza a array
function Organiza(array, t) {

    let lista = [];

    // Verifica quanstos elementos iguais têm na array
    for(let i = 0; i < array.length; i++) {
        let k = 0

        for(let j = 0; j < array.length; j++) {

            if(array[i] === array[j]) {
                k++;
                if(i > j) {
                    k--;

                }
            }
        }

        // Elimina os elementos que não se repetem, e adiciona os que se repetem
        if(k === t) {
            lista[lista.length] = array[i];

        }
    }

    // Chama a função que cria a tabela
    NewTabela(lista);

}

// Exporta a função que cria a tabela 
export function NewTabela(lista) {

    let f, type, c, g1, g2, g3, tabela = '';

    // Cria a tabela
    for(let i = 0; i < lista.length; i++) {

        // Acha os atributos do filme
        for(let j = 0; j < video.length; j++) {

            if(lista[i] === video[j].midia) {
                type = video[j].tipo;
                f = video[j].fase;
                c = video[j].class;
                g1 = video[j].g1;
                g2 = video[j].g2;
                g3 = video[j].g3;
            }

        }

        // Junta a tabela em uma só variável
        tabela += '<tr><td>'+ parseInt(i+1) +'</td><td>'+ lista[i] +'</td><td>'+ type +'</td><td>'+ f +'</td><td>'+ c +'</td><td>'+ g1 +'</td><td>'+ g2 +'</td><td>'+ g3 +'</td></tr>';

    }

    // Cria a tabela no HTML 
    if(lista.length == 0) {
        document.getElementById('mesa').parentNode.removeChild(document.getElementById('mesa'));

        document.getElementById('tabela').innerHTML = '<div id="img"><img id="i404" src="img/404.png" alt="404"/></div>';

    }else {
        document.getElementById('mesa').innerHTML += tabela;

    }
}

function Tipo() {

    // Definindo váriaveis
    let tipos = document.getElementById('tipo').value;
    let t = [];
    let j = 0;

    // Faz uma lista dos filmes com o tipo indicado
    for(let i = 0; i < video.length; i++) {

        if(video[i].tipo == tipos) {
            t[j] = video[i].midia;
            j++;

        }

    }

    // Retorna os nomes dos filmes com o tipo indicado
    return t;

}

function Fases() {

    // Definindo váriaveis
    let fases = document.getElementById('fases').value;
    let f = [];
    let j = 0;

    // Faz uma lista dos filmes com a fase indicada
    for(let i = 0; i < video.length; i++) {

        if(video[i].fase == fases) {
            f[j] = video[i].midia;
            j++;

        }
    
    }

    // Retorna os nomes dos filmes com a fase indicada
    return f;

}

function Class() {

    // Definindo váriaveis
    let classificacao = document.getElementById('classificacao').value;
    let c = [];
    let j = 0;

    // Faz uma lista dos filmes com a classificação indicada
    for(let i = 0; i < video.length; i++) {

        if(video[i].class == classificacao) {
            c[j] = video[i].midia;
            j++;

        }
    }

    // Retorna os nomes dos filmes com a classificação indicada
    return c;

}

function Gen(ge) {

    // Definindo váriaveis
    let g = [];
    let j = 0;

    // Faz uma lista dos filmes com o genêro indicado
    for(let i = 0; i < video.length; i++) {

        if(video[i].g1 == ge) {
            g[j] = video[i].midia;
            j++;

        }else if(video[i].g2 == ge) {
            g[j] = video[i].midia;
            j++;

        }else if(video[i].g3 == ge) {
            g[j] = video[i].midia;
            j++;

        }
    }
    
    // Retorna os nomes dos filmes com o genêro indicado
    return g;

}